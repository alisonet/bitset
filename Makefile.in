.PHONY: all clean test stress install install-headers uninstall

CFLAGS=@CFLAGS@
VERSION=@VERSION@
VERSION_MAJOR=@VERSION_MAJOR@
PREFIX=@PREFIX@
LIBRARY=@LIBRARY@
HEADERS=@HEADERS@
PKGCONFIG_DATA=@LIBRARY@/pkgconfig

all:
	$(MAKE) -C lib all || exit

test: all
	$(MAKE) -C test test || exit

stress: all
	$(MAKE) -C test stress || exit

install-headers:
	mkdir -p $(DESTDIR)/$(HEADERS) || exit
	cp -r include/bitset/* $(DESTDIR)/$(HEADERS) || exit
	chmod 644 $(DESTDIR)/$(HEADERS)/*.h || exit

install: all install-headers
	mkdir -p $(DESTDIR)/$(LIBRARY) || exit
	cp lib/libbitset.so* $(DESTDIR)/$(LIBRARY)/ || exit
	mkdir -p $(DESTDIR)/$(PKGCONFIG_DATA) || exit
	chmod 755 $(DESTDIR)/$(PKGCONFIG_DATA)
	cp build/bitset.pc $(DESTDIR)/$(PKGCONFIG_DATA)/bitset.pc || exit
	cp lib/libbitset.a $(DESTDIR)/$(LIBRARY)/libbitset.a || exit
	chmod 644 $(DESTDIR)/$(LIBRARY)/libbitset.a || exit

uninstall:
	$(MAKE) -C doc uninstall
	rm -f $(DESTDIR)/$(LIBRARY)/libbitset.so*
	rm -f $(DESTDIR)/$(LIBRARY)/libbitset.a
	rm -f $(DESTDIR)/$(HEADERS)/*.h
	rm -f $(DESTDIR)/$(PKGCONFIG_DATA)/bitset.pc

clean:
	$(MAKE) -C lib clean
	$(MAKE) -C test clean
	rm -f *~ *.o
